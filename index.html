<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Bucin Finger Love üíï</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- MediaPipe -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<style>
body {
  margin: 0;
  height: 100vh;
  background: linear-gradient(135deg, #ff5f8f, #ff9a9e);
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: 'Segoe UI', sans-serif;
  color: white;
  overflow: hidden;
  transition: 1s;
}

body.night {
  background: linear-gradient(135deg, #2b1055, #7597de);
}

h1 {
  font-size: 2.3em;
  text-align: center;
  padding: 20px;
  z-index: 2;
  animation: zoom 0.4s ease;
}

@keyframes zoom {
  from {opacity:0; transform:scale(0.8);}
  to {opacity:1; transform:scale(1);}
}

.heart {
  position: absolute;
  font-size: 24px;
  animation: float 2.5s linear forwards;
}

@keyframes float {
  from {transform:translateY(0); opacity:1;}
  to {transform:translateY(-150px); opacity:0;}
}

/* FOTO (AMAN WALAU BELUM ADA) */
#photo {
  position: absolute;
  max-width: 70%;
  border-radius: 20px;
  box-shadow: 0 0 35px rgba(255,255,255,0.6);
  opacity: 0;
  transform: scale(0.8);
  transition: 0.6s ease;
  z-index: 1;
}

/* VIDEO WAJIB ADA TAPI DISAMARKAN (FIX ANDROID) */
video {
  position: fixed;
  top: -1000px;
  left: -1000px;
  width: 1px;
  height: 1px;
  opacity: 0;
}
</style>
</head>

<body>

<h1 id="text">Angkat telunjukmu ‚òùÔ∏è</h1>

<img id="photo" src="" alt="Foto Cinta">

<video id="video" autoplay muted playsinline></video>

<script>
const text = document.getElementById("text");
const body = document.body;
const photo = document.getElementById("photo");
const videoElement = document.getElementById("video");

let lastTime = 0;

function fingerUp(tip, pip) {
  return tip.y < pip.y;
}

function show(msg){
  text.innerText = msg;
  text.style.animation = "none";
  text.offsetHeight;
  text.style.animation = "zoom 0.4s ease";
  if (navigator.vibrate) navigator.vibrate(50);
}

function heart(x, y, count=1) {
  for(let i=0;i<count;i++){
    const h = document.createElement("div");
    h.className = "heart";
    h.innerHTML = "‚ù§Ô∏è";
    h.style.left = x + Math.random()*40 + "px";
    h.style.top = y + "px";
    document.body.appendChild(h);
    setTimeout(()=>h.remove(),2500);
  }
}

function showPhoto(){
  if (!photo.src) return; // aman kalau foto belum ada
  photo.style.opacity = "1";
  photo.style.transform = "scale(1)";
}

function hidePhoto(){
  photo.style.opacity = "0";
  photo.style.transform = "scale(0.8)";
}

/* MEDIAPIPE HANDS */
const hands = new Hands({
  locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
  maxNumHands: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

hands.onResults(results => {

  // DEBUG: pastikan frame masuk
  // console.log("FRAME MASUK");

  if (!results.multiHandLandmarks) return;

  const lm = results.multiHandLandmarks[0];
  const now = Date.now();
  if (now - lastTime < 900) return;

  const index = fingerUp(lm[8], lm[6]);
  const middle = fingerUp(lm[12], lm[10]);
  const ring = fingerUp(lm[16], lm[14]);
  const pinky = fingerUp(lm[20], lm[18]);

  const pinch = Math.hypot(
    lm[4].x - lm[8].x,
    lm[4].y - lm[8].y
  ) < 0.045;

  // ‚òùÔ∏è Telunjuk
  if(index && !middle && !ring && !pinky){
    show("Hai Sayangku üíï");
    heart(lm[8].x*innerWidth, lm[8].y*innerHeight);
    hidePhoto();
    body.classList.remove("night");
  }

  // ‚úåÔ∏è Victory
  else if(index && middle && !ring && !pinky){
    show("Aku Sayang Sama Kamu ü•∞");
    heart(lm[12].x*innerWidth, lm[12].y*innerHeight, 6);
    hidePhoto();
  }

  // ü´∞ Finger Heart
  else if(pinch){
    show("Kamu itu rumahku üè°‚ù§Ô∏è");
    heart(lm[8].x*innerWidth, lm[8].y*innerHeight, 10);
    body.classList.add("night");
    showPhoto();
  }

  // ‚úä Reset
  else if(!index && !middle && !ring && !pinky){
    show("Angkat telunjukmu ‚òùÔ∏è");
    hidePhoto();
    body.classList.remove("night");
  }

  lastTime = now;
});

/* CAMERA (FIX ANDROID) */
const camera = new Camera(videoElement, {
  onFrame: async () => {
    await hands.send({ image: videoElement });
  },
  width: 640,
  height: 480
});

camera.start();
</script>

</body>
</html>
