<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Bucin Finger Love üíï</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- TensorFlow -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose@0.0.7/dist/handpose.min.js"></script>

<style>
body {
  margin: 0;
  height: 100vh;
  background: linear-gradient(135deg, #ff5f8f, #ff9a9e);
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: system-ui, sans-serif;
  color: white;
  text-align: center;
  overflow: hidden;
  perspective: 1000px;
}

h1 {
  font-size: 2.4em;
  padding: 20px;
  transform-style: preserve-3d;
  transition: transform 0.08s linear;
  text-shadow:
    1px 1px 0 #e6004c,
    2px 2px 0 #d60047,
    3px 3px 12px rgba(0,0,0,0.4);
}

#start {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 1.6em;
  font-weight: bold;
  cursor: pointer;
  z-index: 10;
}

video {
  position: fixed;
  top: -1000px;
  left: -1000px;
  width: 1px;
  height: 1px;
  opacity: 0;
}
</style>
</head>

<body>

<h1 id="text">Tekan MULAI üíï</h1>
<video id="video" autoplay muted playsinline></video>
<div id="start">üíó MULAI üíó</div>

<script>
const text = document.getElementById("text");
const video = document.getElementById("video");
const startBtn = document.getElementById("start");

let model;
let running = false;

// transform state
let scale = 1;
let rotation = 0;
let depth = 0;

function show(msg) {
  if (text.innerText === msg) return;
  text.innerText = msg;
  navigator.vibrate?.(40);
}

async function setupCamera() {
  const stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "user" }
  });
  video.srcObject = stream;
  await video.play();
}

function fingerUp(tip, pip) {
  return tip[1] < pip[1] - 10; // buffer 10px
}
let lastGesture = "";
let stableCount = 0;

function commitGesture(name) {
  if (name === lastGesture) {
    stableCount++;
  } else {
    lastGesture = name;
    stableCount = 0;
  }

  if (stableCount === 6) { // tahan ¬±6 frame
    show(name);
  }
}

/* ZOOM pakai pinch */
function updateZoom(lm) {
  const dx = lm[4][0] - lm[8][0];
  const dy = lm[4][1] - lm[8][1];
  const dist = Math.hypot(dx, dy);

  let targetScale = dist / 120;
  targetScale = Math.min(Math.max(targetScale, 0.7), 1.8);
  scale += (targetScale - scale) * 0.2;
}

/* ROTATE + DEPTH */
function updateRotateAndDepth(lm) {
  const angle = Math.atan2(
    lm[8][1] - lm[5][1],
    lm[8][0] - lm[5][0]
  );
  rotation += ((angle * 30) - rotation) * 0.15;

  const palmWidth = Math.hypot(
    lm[5][0] - lm[17][0],
    lm[5][1] - lm[17][1]
  );
  let targetDepth = (palmWidth - 80) * 0.6;
  targetDepth = Math.min(Math.max(targetDepth, -80), 80);
  depth += (targetDepth - depth) * 0.15;

  text.style.transform = `
    scale(${scale})
    rotate(${rotation}deg)
    translateZ(${depth}px)
  `;
}

async function detect() {
  if (!running) return;

  const predictions = await model.estimateHands(video);

  if (predictions.length > 0) {
    const lm = predictions[0].landmarks;

    const index = fingerUp(lm[8], lm[6]);
    const middle = fingerUp(lm[12], lm[10]);
    const ring = fingerUp(lm[16], lm[14]);
    const pinky = fingerUp(lm[20], lm[18]);

    const pinchDist = Math.hypot(
  lm[4][0] - lm[8][0],
  lm[4][1] - lm[8][1]
);
const pinch = pinchDist < 35; // lebih ketat

    if (pinch) {
  commitGesture("Kamu itu rumahku üè°‚ù§Ô∏è");
}
else if (index && middle && !ring && !pinky) {
  commitGesture("Aku Sayang Sama Kamu ü•∞");
}
else if (index && !middle && !ring && !pinky) {
  commitGesture("Hai Sayangku üíï");
}
else if (!index && !middle && !ring && !pinky) {
  commitGesture("Angkat telunjukmu ‚òùÔ∏è");
}

    updateZoom(lm);
    updateRotateAndDepth(lm);
  }

  requestAnimationFrame(detect);
}

startBtn.onclick = async () => {
  startBtn.remove();
  show("Angkat telunjukmu ‚òùÔ∏è");
  await setupCamera();
  model = await handpose.load();
  running = true;
  detect();
};
</script>

</body>
</html>
