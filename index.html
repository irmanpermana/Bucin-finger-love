<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Bucin Cinematic üíô</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- TensorFlow -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose@0.0.7/dist/handpose.min.js"></script>

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:black;
  overflow:hidden;
  font-family:system-ui;
}

/* ===== TEXT ===== */
#content{
  position:absolute;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  color:white;
  font-size:2em;
  text-align:center;

  opacity:0;
  transform:scale(.85);
  filter:blur(14px);

  transition:
    opacity .8s ease,
    transform 1s ease,
    filter 1s ease;
}

#content.show{
  opacity:1;
  transform:scale(1);
  filter:blur(0);
  animation:float 4s ease-in-out infinite;
}

@keyframes float{
  0%{transform:scale(1) translateY(0)}
  50%{transform:scale(1) translateY(-6px)}
  100%{transform:scale(1) translateY(0)}
}

/* ===== HEART ===== */
#heart{
  font-size:4em;
  animation:pulse 1.6s infinite;
}

@keyframes pulse{
  0%{transform:scale(1);opacity:.7}
  50%{transform:scale(1.2);opacity:1}
  100%{transform:scale(1);opacity:.7}
}

/* ===== CANVAS ===== */
canvas{
  position:absolute;
  inset:0;
  pointer-events:none;
}

/* ===== PHOTO ===== */
#photo{
  position:absolute;
  max-width:70%;
  border-radius:22px;
  opacity:0;
  transform:scale(.6);
  filter:blur(14px);
  transition:1s ease;
  box-shadow:0 0 80px rgba(0,150,255,.8);
}

/* ===== CAMERA (HIDDEN) ===== */
video{
  position:fixed;
  width:1px;
  height:1px;
  opacity:0;
}
</style>
</head>

<body>

<canvas id="particleCanvas"></canvas>

<div id="content">
  <div id="heart">‚ù§Ô∏è</div>
</div>

<!-- ganti foto di sini -->
<img id="photo" src="foto/IMG-20251103-WA0038.jpg">
<video id="video" autoplay muted playsinline></video>

<script>
/* ===== SLIDES ===== */
const slides=[
  "Hai Sayangku ü•∞",
  "Aku Sayang Kamu üòò",
  "Kamu adalah Rumah bagiku üè°",
  "Aku Berharap Kita Bisa Terus Bersama Sampai Kapanpun ü´∂üèªü§ó",
  "Terimakasih Sayang Udah Mau Nerima Aku Dengan Segala Kekuranganku.. ü•∞"
];
let index=-1;

/* ===== ELEMENT ===== */
const content=document.getElementById("content");
const heart=document.getElementById("heart");
const photo=document.getElementById("photo");
const video=document.getElementById("video");

/* ===== PARTICLE ===== */
const canvas=document.getElementById("particleCanvas");
const ctx=canvas.getContext("2d");
let particles=[];

function resize(){
  canvas.width=innerWidth;
  canvas.height=innerHeight;
}
resize();
addEventListener("resize",resize);

function createParticles(text){
  particles=[];
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="white";
  ctx.font="bold 42px system-ui";
  ctx.textAlign="center";
  ctx.fillText(text,canvas.width/2,canvas.height/2);

  const data=ctx.getImageData(0,0,canvas.width,canvas.height).data;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  for(let y=0;y<canvas.height;y+=6){
    for(let x=0;x<canvas.width;x+=6){
      const i=(y*canvas.width+x)*4;
      if(data[i+3]>150){
        particles.push({
          x:Math.random()*canvas.width,
          y:Math.random()*canvas.height,
          tx:x,
          ty:y,
          a:0
        });
      }
    }
  }
}

function animateParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  particles.forEach(p=>{
    p.x+=(p.tx-p.x)*.08;
    p.y+=(p.ty-p.y)*.08;
    p.a=Math.min(p.a+.03,1);
    ctx.fillStyle=`rgba(0,150,255,${p.a})`;
    ctx.fillRect(p.x,p.y,2,2);
  });
  if(particles.length)requestAnimationFrame(animateParticles);
}

/* ===== UI ===== */
function showHeart(){
  content.classList.remove("show");
  content.innerHTML='<div id="heart">‚ù§Ô∏è</div>';
  photo.style.opacity=0;
  photo.style.transform="scale(.6)";
  photo.style.filter="blur(14px)";
}

function showSlide(text){
  content.classList.remove("show");
  content.innerText="";
  heart.style.display="none";

  createParticles(text);
  animateParticles();

  setTimeout(()=>{
    content.innerText=text;
    content.classList.add("show");
  },900);
}

function showPhoto(){
  photo.style.opacity=1;
  photo.style.transform="scale(1)";
  photo.style.filter="blur(0)";
}

/* ===== CAMERA ===== */
async function setupCamera(){
  const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});
  video.srcObject=stream;
  return new Promise(r=>video.onloadedmetadata=r);
}

/* ===== HAND DETECTION ===== */
let model;
let lock="";

function up(t,p){return t[1]<p[1];}

async function detect(){
  const hands=await model.estimateHands(video);

  if(!hands.length){
    showHeart();
    lock="";
    return requestAnimationFrame(detect);
  }

  const lm=hands[0].landmarks;
  const indexFinger=up(lm[8],lm[6]);
  const middleFinger=up(lm[12],lm[10]);

  if(indexFinger&&!middleFinger&&lock!=="next"){
    index=(index+1)%slides.length;
    showSlide(slides[index]);
    lock="next";
  }
  else if(indexFinger&&middleFinger&&lock!=="photo"){
    showPhoto();
    lock="photo";
  }
  else if(!indexFinger&&!middleFinger){
    lock="";
  }

  requestAnimationFrame(detect);
}

/* ===== START ===== */
(async()=>{
  await setupCamera();
  model=await handpose.load();
  showHeart();
  detect();
})();
</script>

</body>
</html>
